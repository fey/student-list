#!/usr/bin/env php
<?php

use function App\Functions\baseDir;

require_once __DIR__ . '/../vendor/autoload.php';

echo "Starting seeds database...\n";

$baseDir = baseDir();
$pdo = new PDO("sqlite:{$baseDir}/database/development.sqlite3");
$pdo->exec('DELETE FROM students');

$birthday = new DateTime('1970-01-01');

$valuesParts = array_reduce(range(1, 10), function ($acc, $i) use ($birthday) {
    $examPoints = rand(50, 200);
    $query = "('first_name ${i}', 'last_name ${i}', 'male', 'student${i}@test.io', 'ASDF123', '', '{$birthday->format('Y-m-d')}', '{$examPoints}')";

    return [...$acc, $query];
}, []);

$joinedValuesParts = implode(",\n",$valuesParts);

$resultQuery = "INSERT INTO students (first_name, last_name, gender, email, group_id, hashed_password, birthday, exam_points) VALUES {$joinedValuesParts};\n";

$pdo->exec($resultQuery);

echo "...Done!\n";
